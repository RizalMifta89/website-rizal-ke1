<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SnapTikTok - Debug Mode</title>
    <style>
        body { font-family: sans-serif; background: #000; color: white; display: flex; flex-direction: column; align-items: center; padding: 20px; text-align: center; }
        input { width: 100%; padding: 15px; margin-bottom: 10px; }
        button { width: 100%; padding: 15px; background: #ff0050; color: white; border: none; font-weight: bold; cursor: pointer; }
        .box { border: 1px solid white; padding: 20px; margin-top: 20px; width: 100%; display: none; }
        a { color: cyan; font-size: 1.2rem; font-weight: bold; }
    </style>
</head>
<body>

    <h1>üîç MODE DETEKTIF</h1>
    <p>Mari kita cari tahu kenapa error!</p>

    <input type="text" id="urlInput" placeholder="Tempel Link TikTok...">
    <button onclick="cekMasalah()">Cek & Download</button>

    <div id="statusBox" style="margin-top: 20px; color: yellow;"></div>

    <div id="resultArea" class="box">
        <h3 id="judul"></h3>
        <a id="linkDown" href="#" target="_blank">KLIK UNTUK DOWNLOAD MP4</a>
    </div>

    <script>
        async function cekMasalah() {
            const inputUrl = document.getElementById('urlInput').value;
            const status = document.getElementById('statusBox');
            
            if(!inputUrl) { alert("Link kosong!"); return; }

            // URL Render Anda (Sudah diperbaiki)
            const API_URL = "https://mesin-website-rizal-ke1.onrender.com/api/download";

            // 1. LAPORAN DETEKTIF: Cek Link Apa yang Dipakai
            status.innerText = "1. Mencoba menghubungi: \n" + API_URL;
            
            try {
                const response = await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ url: inputUrl })
                });

                // 2. LAPORAN DETEKTIF: Cek Status Server
                status.innerText += "\n\n2. Status Server: " + response.status;

                if (response.status === 403) {
                    alert("‚ö†Ô∏è DETEKTIF MENEMUKAN MASALAH:\nServer menolak (403 Forbidden).\nIni biasanya karena Vercel memblokir Render, atau Jaringan HP memblokir Render.");
                } else if (response.status === 500) {
                    alert("‚ö†Ô∏è DETEKTIF MENEMUKAN MASALAH:\nMesin Render Error (Mungkin link TikTok tidak valid/susah diambil).");
                }

                const data = await response.json();

                if (data.status === "success") {
                    status.innerText += "\n\n3. BERHASIL! Data diterima.";
                    document.getElementById('judul').innerText = data.title;
                    document.getElementById('linkDown').href = data.download_url;
                    document.getElementById('resultArea').style.display = "block";
                } else {
                    status.innerText += "\n\n3. GAGAL: " + JSON.stringify(data);
                }

            } catch (error) {
                status.innerText += "\n\n‚ùå ERROR PARAH: " + error.message;
                alert("ERROR JARINGAN!\nBrowser Anda gagal menghubungi Render.\nPastikan sinyal bagus atau coba pakai Wifi.");
            }
        }
    </script>
</body>
</html>